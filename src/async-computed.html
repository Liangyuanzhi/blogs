<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>异步计算属性</title>
    <link rel="icon" href="images/logo.png" type="image/png">
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" href="css/pages.css">
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/1.4.0/css/bootstrap.min.css">
		<script src="js/vue.js"></script>
		<script>
		  Vue.config.productionTip = false
		  window.PAGE_TYPE = "guide"
		</script>
  </head>
  <body class="docs">
    <div id="mobile-bar">
      <a class="menu-button"></a>
      <a class="logo"></a>
    </div>
    <header id="header">
      <a href="javascript:;" id="logo">
        <img src="./images/logo.png" alt="">
        <span>Blogs</span>
      </a>
      <ul id="nav">
        <li class="nav-dropdown-container learn">
          <a href="" nav-link current>学习</a>
          <span class="arrow"></span>
          <ul class="nav-dropdown">
            <li>
              <h4>文档</h4>
            </li>
            <li>
              <ul>
                <li><a target="_blank" href="https://www.lodashjs.com/">Lodash</a></li>
                <li><a target="_blank" href="https://vuex.vuejs.org/zh/">Vuex</a></li>
                <li><a target="_blank" href="http://caibaojian.com/es6/">Es6语法糖</a></li>
                <li><a target="_blank" href="https://www.tslang.cn/docs/release-notes/typescript-3.1.html">Typescript</a></li>
              </ul>
            </li>
            <li>
              <h4>UI库</h4>
            </li>
            <li>
              <ul>
                <li><a target="_blank" href="https://element.eleme.cn/#/zh-CN/component/installation">Element</a></li>
                <li><a target="_blank" href="https://www.antdv.com/docs/vue/introduce-cn/">Vue design</a></li>
                <li><a target="_blank" href="https://ant.design/components/overview-cn/">React design</a></li>
                <li><a target="_blank" href="https://v3.bootcss.com/components/">Bootstrap</a></li>
                <li><a target="_blank" href="https://dev.dcloud.net.cn/mui/ui/">Mui</a></li>
                <li><a target="_blank" href="https://youzan.github.io/vant/next/#/zh-CN/">Vant</a></li>
                <li><a target="_blank" href="https://v3.bootcss.com/components/">Bootstrap</a></li>
                <li><a target="_blank" href="https://avuejs.com/doc/image-preview">Avue</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li class="nav-dropdown-container learn">
          <a href="" nav-link current>设置</a>
          <span class="arrow"></span>
          <ul class="nav-dropdown">
            <li>
              <ul>
                <li><a target="_blank" href="profile.html">个人中心</a></li>
                <li><a target="_blank" href="https://github.com/Liangyuanzhi/blogs">Github地址</a></li>
                <li><a target="_blank" href="https://github.com/Liangyuanzhi/blogs/issues">有反馈?</a></li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </header>


    <div id="main" class="fix-sidebar">
      <div class="sidebar">
        <div class="sidebar-inner">
          <div class="list">
            <ul class="menu-root">
              <li>
                <a href="index.html" class="sidebar-link">Vue中的Keep-Alive</a>
              </li>
              <li>
                <a href="async-computed.html" class="sidebar-link current">异步计算属性</a>
              </li>
              <li>
                <a href="display-flex.html" class="sidebar-link">Css布局</a>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <div class="content guide with-sidebar computed-guide">
        <h2 id="异步和非异步区别">异步和非异步区别</h2>
        <p>不使用这个插件(AsyncComputed)，你不能使用vue.js提供的计算属性computed这么获取数据</p>
<pre><code class="hljs js"><span class="hljs-tag"><span class="hljs-keyword">new Vue</span></span> ({
<span class="hljs-tag">computed:</span> {
  <span class="hljs-built_in">async </span><span class="hljs-keyword">username</span> () {
    <span class="hljs-built_in">const </span>res = <span class="hljs-built_in">await</span><span class="hljs-keyword"> axios.get</span>('/get-username-by-id/' + this.<span class="hljs-tag">userid</span>)
    <span class="hljs-keyword">return</span> res
  }
 }
)}
</code></pre>
        <p>或者更确切地说，你可以，但它不会做你想让它做的事。但是使用这个插件，它就像你期望的那样工作</p>
<pre><code class="hljs js"><span class="hljs-tag"><span class="hljs-keyword">new Vue</span></span> ({
<span class="hljs-tag">asyncComputed:</span> {
  <span class="hljs-built_in">async </span><span class="hljs-keyword">someCalculation</span> () {
    <span class="hljs-built_in">const </span>x = <span class="hljs-built_in">await</span> <span class="hljs-keyword">someAsycFunction()</span>
    <span class="hljs-built_in">const </span>y = <span class="hljs-built_in">await</span> <span class="hljs-keyword">anotherAsyncFunction()</span>
    <span class="hljs-keyword">return</span> x + y
  }
 }
)}
</code></pre>

        <h2 id="安装">安装</h2>
        <p>npm</p>
<pre><code>npm install --save vue-async-computed</code></pre>
        <p>或者，你可以直接从一个CDN链接它:</p>
<pre><code class="hljs js">
<span class="hljs-comment">// 它总是指向最新版本的vue-async-computed。</span>
<span class="hljs-tag">&lt;script</span><span class="hljs-attr"> src</span>=<span class="hljs-string">"https://unpkg.com/vue-async-computed'</span><span class="hljs-tag">&gt; &lt;/script&gt;</span>
<span class="hljs-comment">// 你可能想把它钉在一个特定的版本上。</span>
<span class="hljs-tag">&lt;script</span><span class="hljs-attr"> src</span>=<span class="hljs-string">"https://unpkg.com/vue-async-computed@3.9.0</span><span class="hljs-tag">&gt; &lt;/script&gt;</span></code></pre>
        <p>当使用一个模块系统，如webpack或browserify，你需要显式安装通过Vue.use()</p>
<pre><code class="hlj js"><span class="hljs-keyword">import Vue from</span>'vue'
<span class="hljs-keyword">import AsyncComputed from </span>'vue-async-computed'
Vue.use(AsyncComputed)
</code></pre>
        <h2 id="使用">使用</h2>
<pre><code class="hlj js"><span class="hljs-keyword">import Vue from</span>'vue'
<span class="hljs-keyword">import AsyncComputed from </span>'vue-async-computed'
Vue.use(AsyncComputed)
<span class="hljs-comment">/**
  然后，在创建Vue实例(或组件)时，
  您还可以传递名为“asyncComputed”的对象
  或者代替标准的“计算”选项。的函数
  传递给“asyncComputed”应该返回承诺和值
  然后将解析为的承诺异步绑定到
  Vue实例，当他们解决。就像普通的计算一样
  属性，如果属性所依赖的数据发生了更改
  然后自动重新运行该属性。
  你几乎可以完全忽略这个事实
  场景是异步的。要记住的一件事是
  直到异步属性的承诺被解析为止
  第一次，计算属性的值为null。
*/</span>
<span class="hljs-tag"><span class="hljs-keyword">new Vue</span></span> ({
 <span class="hljs-tag">asyncComputed:</span> {
  <span class="hljs-built_in">async </span><span class="hljs-keyword">someCalculation</span> () {
    const total = this.x + this.y
    <span class="hljs-keyword">return new Promise</span>(resolve =>
      setTimeout(() => resolve(total), 1000)
    )
  }
 }
)}

<span class="hljs-comment">/**
 与常规同步计算属性一样，您可以使用get方法而不是函数传递对象，
 但与常规计算属性不同的是，异步计算属性总是仅使用getter。
 如果提供的对象具有set方法，则将忽略该方法。
 异步计算属性也可以有一个自定义的默认值，它将被使用，直到数据是第一次加载:
 */</span>
 <span class="hljs-tag"><span class="hljs-keyword">new Vue</span></span> ({
  <span class="hljs-tag">asyncComputed:</span> {
    blogPostContent: {
     <span class="hljs-tag">get</span> () {
      http.get('/post/' + this.postId)
       .then(response => response.data.postContent)
     },
      <span class="hljs-tag">default</span> () {
      <span class="hljs-keyword">return Vue.</span>'Loading post ' + this.<span class="hljs-tag">postId</span>
     },
    }
   }
 )}
</code></pre>
      </div>
    </div>
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="js/smooth-scroll.min.js"></script>
    <script src="js/css.escape.js"></script>
    <script src="js/common.js"></script>
  </body>
</html>
